timeout: 1800s

options:
  env:
  - PROJECT_ID=$PROJECT_ID
  - WORKSPACE_LINK=/go/src/github.com/m-lab/locate

steps:
# Run unit tests for environment.
- name: gcr.io/$PROJECT_ID/golang-cbif
  args:
   - go get -v -t ./...
   - go vet ./...
   - go test ./... -race
   - go test -v ./...

# Perform deployment in sandbox & staging & mlab-ns.
- name: gcr.io/$PROJECT_ID/gcloud-jsonnet-cbif
  env:
    # Use cbif condition: only run these steps in one of these projects.
    - PROJECT_IN=mlab-sandbox,mlab-staging
  args:
    - gcloud --project $PROJECT_ID app deploy --promote cmd/locate/app.yaml
