dist: jammy

language: go
go: go1.20.14

addons:
  apt:
    update: true
    packages:
    - ca-certificates

before_install:
# Force setup of go1.20.14 since travis evidently forces 1.23
- rm -f /home/travis/gopath/bin/go # remove existing symbolic link for travis_setup_go.
- travis_setup_go 1.20.14
- go version
- go env

install:
- go install -v ./...
- go install github.com/mattn/goveralls@latest

script:
- go vet ./...
- go test -timeout 5m -p 1 ./... -cover=1 -coverprofile=_c.cov
- go test -timeout 5m ./... -race

after_success:
# Note: Do this in the after_success stage so that
# a broken coveralls won't cause the build to fail.
# (details: https://github.com/lemurheavy/coveralls-public/issues/1264)
- $GOPATH/bin/goveralls -service=travis-pro -coverprofile=_c.cov
